<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Server 2022 - Hyper-V - Virtual Machine Templates" /><meta property="og:locale" content="en" /><meta name="description" content="A minimal website for tech tips, blogs and video documentation." /><meta property="og:description" content="A minimal website for tech tips, blogs and video documentation." /><link rel="canonical" href="https://marcmylemans.github.io/posts/Server2022-Hyper-V-VirtualMachineTemplates/" /><meta property="og:url" content="https://marcmylemans.github.io/posts/Server2022-Hyper-V-VirtualMachineTemplates/" /><meta property="og:site_name" content="Mylemans Online" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-18T09:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Server 2022 - Hyper-V - Virtual Machine Templates" /><meta name="google-site-verification" content="google445ce971c729a3a8.html" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-07T15:08:20+01:00","datePublished":"2022-12-18T09:00:00+01:00","description":"A minimal website for tech tips, blogs and video documentation.","headline":"Server 2022 - Hyper-V - Virtual Machine Templates","mainEntityOfPage":{"@type":"WebPage","@id":"https://marcmylemans.github.io/posts/Server2022-Hyper-V-VirtualMachineTemplates/"},"url":"https://marcmylemans.github.io/posts/Server2022-Hyper-V-VirtualMachineTemplates/"}</script><title>Server 2022 - Hyper-V - Virtual Machine Templates | Mylemans Online</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mylemans Online"><meta name="application-name" content="Mylemans Online"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.3/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="https://avatars.githubusercontent.com/u/33804113?v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><h1 class="site-title"> <a href="/">Mylemans Online</a></h1><p class="site-subtitle fst-italic mb-0">Tech tips, blogs and video documentation</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/Referral-Links/" class="nav-link"> <i class="fa-fw fas fa-link"></i> <span>REFERRAL LINKS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/marcmylemans" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['info','mylemans.online'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/marc-mylemans-887567b9/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Server 2022 - Hyper-V - Virtual Machine Templates</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Server 2022 - Hyper-V - Virtual Machine Templates</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1671350400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 18, 2022 </time> </span> <span> Updated <time data-ts="1704636500" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 7, 2024 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/marcmylemans">Marc Mylemans</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2031 words" > <em>11 min</em> read</span></div></div></header><div class="content"><style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class="embed-container"> <iframe title="YouTube video player" width="640" height="390" src="//www.youtube.com/embed/14-tJsdW7LU" frameborder="0" allowfullscreen=""></iframe></div><p>Welcome to a crucial part of managing and optimizing your virtual environment using Hyper-V on Windows Server 2022. In this video, we are going to delve into the process of creating a virtual machine template. This is a key step in maximizing efficiency and scalability in your virtualization strategy.</p><p>A virtual machine template is essentially a master copy of a virtual machine that can be used repeatedly to create new instances. This ensures that each VM is configured consistently, with the same set of files, settings, and software. This process not only saves time but also greatly reduces the possibility of human error during the VM creation process.</p><h3 id="why-use-vm-templates"><span class="me-2">Why Use VM Templates?</span><a href="#why-use-vm-templates" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><strong>Speed and Efficiency</strong>: Deploy new virtual machines within minutes, not hours, keeping your environment agile and responsive.<li><strong>Consistency and Standardization</strong>: Ensure that each VM is set up with the exact same configuration, which is crucial for testing environments and load balancing.<li><strong>Ease of Management</strong>: With templates, you can manage your base image in one place, ensuring that updates or changes are uniformly implemented.</ol><p>In the video, I will walk you through the step-by-step process of creating a VM template in Windows Server 2022’s Hyper-V. We’ll cover everything from selecting the right base image to configuring the VM settings for optimal use.</p><h3 id="the-script-for-automation"><span class="me-2">The Script for Automation</span><a href="#the-script-for-automation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To further streamline this process, I’ve included a PowerShell script that automates the creation and configuration of VMs from the template. This script allows for the specification of various parameters like the number of CPUs, amount of RAM, and network settings, making it highly customizable to your needs.</p><h3 id="disclaimer-for-script-usage"><span class="me-2">Disclaimer for Script Usage</span><a href="#disclaimer-for-script-usage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>Please read the following disclaimer carefully before proceeding with the script implementation:</strong></p><p>Please note that the script provided in this blog post is intended for educational and professional use only. Before implementing the script, consider the following:</p><p>Compatibility and Environment: Ensure that the script is compatible with your system’s configuration and Windows Server version. The script is designed for Windows Server 2022 and Hyper-V environments.</p><p>Modification and Testing: You may need to modify the script to suit your specific environment or requirements. It is strongly recommended to test the script in a non-production environment before deploying it in a live setting.</p><p>Data and System Integrity: While every effort has been made to ensure the reliability of the script, I am not responsible for any data loss or system disruptions that may occur from its use. Always back up your data and configuration settings before running any new scripts.</p><p>Expertise Required: The implementation of this script should be conducted by individuals with an understanding of Windows Server administration, Hyper-V, and PowerShell scripting.</p><p>Support and Updates: This script is provided ‘as is’, without warranty of any kind. As such, there is no ongoing support or guarantee of future updates.</p><p>By using this script, you acknowledge and accept the risks associated with its deployment and agree to do so at your own discretion and liability.</p><p>Here’s the script:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
</pre><td class="rouge-code"><pre><span class="c">######################################################</span><span class="w">
</span><span class="c">###              Template Definition               ###</span><span class="w">
</span><span class="c">######################################################</span><span class="w">

</span><span class="c"># Sysprep VHD path (The VHD will be copied to the VM folder)</span><span class="w">
</span><span class="nv">$SysVHDPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\Path\To\Your\Template\vTemplateServer2022.vhdx"</span><span class="w">


</span><span class="bp">$_</span><span class="n">Customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-host</span><span class="p">(</span><span class="s1">'Wich Customer?'</span><span class="p">)</span><span class="w">
</span><span class="bp">$_</span><span class="n">VM_Role</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-host</span><span class="p">(</span><span class="s1">'Give the VM a Role. Ex. DC = Domain Controller, TS = Terminal Server, DB/SQL = Database/SQL Server'</span><span class="p">)</span><span class="w">
</span><span class="bp">$_</span><span class="n">TotalVMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="p">(</span><span class="s1">'Total number of this vm Ex. srv-dc-01 - srv-dc-02'</span><span class="p">)</span><span class="w">
</span><span class="bp">$_</span><span class="n">CPU_Cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="p">(</span><span class="s1">'How many Cores to assign? Ex. 2, 4, 6,...'</span><span class="p">)</span><span class="w">
</span><span class="p">[</span><span class="n">int64</span><span class="p">]</span><span class="bp">$_</span><span class="n">RAM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="n">GB</span><span class="o">*</span><span class="p">(</span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"How many RAM to assign? Ex. 4, 6, 8,..."</span><span class="p">)</span><span class="w">
</span><span class="bp">$_</span><span class="n">VlanID</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">Read-Host</span><span class="p">(</span><span class="s1">'Wich Vlan to Assign? Ex. 002'</span><span class="p">)</span><span class="w">

</span><span class="nv">$VMName</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"v"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="n">VlanID</span><span class="w"> </span><span class="o">+</span><span class="s2">"-"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="nx">Customer</span><span class="w"> </span><span class="o">+</span><span class="s2">"-ADC"</span><span class="w"> </span><span class="o">+</span><span class="s2">"-"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="nx">VM_Role</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="w">

</span><span class="n">ECHO</span><span class="w"> </span><span class="nx">Creating</span><span class="w"> </span><span class="nx">New</span><span class="w"> </span><span class="nx">VM:</span><span class="w">


</span><span class="mi">1</span><span class="o">..</span><span class="bp">$_</span><span class="n">TotalVMS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w">

</span><span class="c"># VM Name</span><span class="w">
</span><span class="nv">$VMName</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">"v"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="n">VlanID</span><span class="w"> </span><span class="o">+</span><span class="s2">"-"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="nx">Customer</span><span class="w"> </span><span class="o">+</span><span class="s2">"-"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="nx">VM_Role</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$_</span><span class="w">
</span><span class="c"># Automatic Start Action (Nothing = 0, Start =1, StartifRunning = 2)</span><span class="w">
</span><span class="nv">$AutoStartAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="c"># In second</span><span class="w">
</span><span class="nv">$AutoStartDelay</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span><span class="c"># Automatic Start Action (TurnOff = 0, Save =1, Shutdown = 2)</span><span class="w">
</span><span class="nv">$AutoStopAction</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">


</span><span class="c">###### Hardware Configuration ######</span><span class="w">
</span><span class="c"># VM Path</span><span class="w">
</span><span class="nv">$VMPath</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\Path\To\Your\Virtual Machines"</span><span class="w">
</span><span class="nv">$VHDPath</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\Path\To\Your\Virtual Hard Disks"</span><span class="w">

</span><span class="c"># VM Generation (1 or 2)</span><span class="w">
</span><span class="nv">$Gen</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">

</span><span class="c"># Processor Number</span><span class="w">
</span><span class="nv">$ProcessorCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="n">CPU_Cores</span><span class="w">

</span><span class="c">## Memory (Static = 0 or Dynamic = 1)</span><span class="w">
</span><span class="nv">$Memory</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="c"># StaticMemory</span><span class="w">
</span><span class="nv">$StaticMemory</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="n">RAM</span><span class="w">

</span><span class="c"># DynamicMemory</span><span class="w">
</span><span class="nv">$StartupMemory</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="n">RAM</span><span class="w">
</span><span class="nv">$MinMemory</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="n">RAM</span><span class="w">
</span><span class="nv">$MaxMemory</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="n">RAM</span><span class="w">


</span><span class="c"># Rename the VHD copied in VM folder to:</span><span class="w">
</span><span class="nv">$OsDiskName</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"-C"</span><span class="w">

</span><span class="c">### Additional virtual drives</span><span class="w">
</span><span class="c">#$ExtraDrive  = @()</span><span class="w">
</span><span class="c"># Drive 1</span><span class="w">
</span><span class="c">#$Drive       = New-Object System.Object</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Name -Value Data</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Path -Value $($VHDPath + "\" + $VMName)</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Size -Value 10GB</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Type -Value Dynamic</span><span class="w">
</span><span class="c">#$ExtraDrive += $Drive</span><span class="w">

</span><span class="c"># Drive 2</span><span class="w">
</span><span class="c">#$Drive       = New-Object System.Object</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Name -Value Bin</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Path -Value $($VHDPath + "\" + $VMName)</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Size -Value 20GB</span><span class="w">
</span><span class="c">#$Drive       | Add-Member -MemberType NoteProperty -Name Type -Value Fixed</span><span class="w">
</span><span class="c">#$ExtraDrive += $Drive</span><span class="w">
</span><span class="c"># You can copy/delete this below block as you wish to create (or not) and attach several VHDX</span><span class="w">

</span><span class="c">### Network Adapters</span><span class="w">
</span><span class="c"># Primary Network interface: VMSwitch </span><span class="w">
</span><span class="nv">$VMSwitchName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"vSwitch_LAN"</span><span class="w">
</span><span class="nv">$VlanId</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="n">VlanID</span><span class="w">
</span><span class="nv">$VMQ</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">$False</span><span class="w">
</span><span class="nv">$IPSecOffload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$False</span><span class="w">
</span><span class="nv">$SRIOV</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">$False</span><span class="w">
</span><span class="nv">$MacSpoofing</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">$False</span><span class="w">
</span><span class="nv">$DHCPGuard</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">$False</span><span class="w">
</span><span class="nv">$RouterGuard</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">$False</span><span class="w">
</span><span class="nv">$NicTeaming</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">$False</span><span class="w">

</span><span class="c">## Additional NICs</span><span class="w">
</span><span class="nv">$NICs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">

</span><span class="c"># NIC 1</span><span class="w">
</span><span class="c">#$NIC   = New-Object System.Object</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name VMSwitch -Value "vSwitch"</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name VLAN -Value 20</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name VMQ -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name IPsecOffload -Value $True</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name SRIOV -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name MacSpoofing -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name DHCPGuard -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name RouterGuard -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name NICTeaming -Value $False</span><span class="w">
</span><span class="c">#$NICs += $NIC</span><span class="w">

</span><span class="c">#NIC 2</span><span class="w">
</span><span class="c">#$NIC   = New-Object System.Object</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name VMSwitch -Value "LS_VMWorkload"</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name VLAN -Value 20</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name VMQ -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name IPsecOffload -Value $True</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name SRIOV -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name MacSpoofing -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name DHCPGuard -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name RouterGuard -Value $False</span><span class="w">
</span><span class="c">#$NIC   | Add-Member -MemberType NoteProperty -Name NICTeaming -Value $False</span><span class="w">
</span><span class="c">#$NICs += $NIC</span><span class="w">
</span><span class="c"># You can copy/delete the above block and set it for additional NIC</span><span class="w">


</span><span class="c">######################################################</span><span class="w">
</span><span class="c">###           VM Creation and Configuration        ###</span><span class="w">
</span><span class="c">######################################################</span><span class="w">

</span><span class="c">## Creation of the VM</span><span class="w">
</span><span class="c"># Creation without VHD and with a default memory value (will be changed after)</span><span class="w">
</span><span class="n">New-VM</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="se">`
</span><span class="w">       </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$VMPath</span><span class="w"> </span><span class="se">`
</span><span class="w">       </span><span class="nt">-NoVHD</span><span class="w"> </span><span class="se">`
</span><span class="w">       </span><span class="nt">-Generation</span><span class="w"> </span><span class="nv">$Gen</span><span class="w"> </span><span class="se">`
</span><span class="w">       </span><span class="nt">-Version</span><span class="w"> </span><span class="nx">9.0</span><span class="w"> </span><span class="se">`
</span><span class="w">       </span><span class="nt">-MemoryStartupBytes</span><span class="w"> </span><span class="nx">1GB</span><span class="w"> </span><span class="se">`
</span><span class="w">       </span><span class="nt">-SwitchName</span><span class="w"> </span><span class="nv">$VMSwitchName</span><span class="w">


</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$AutoStartAction</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="nv">$StartAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Nothing"</span><span class="p">}</span><span class="w">
</span><span class="kr">Elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$AutoStartAction</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="nv">$StartAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Start"</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="p">{</span><span class="nv">$StartAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"StartIfRunning"</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$AutoStopAction</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="nv">$StopAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TurnOff"</span><span class="p">}</span><span class="w">
</span><span class="kr">Elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$AutoStopAction</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span><span class="nv">$StopAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Save"</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="p">{</span><span class="nv">$StopAction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Shutdown"</span><span class="p">}</span><span class="w">

</span><span class="c">## Changing the number of processor and the memory</span><span class="w">
</span><span class="c"># If Static Memory</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nv">$Memory</span><span class="p">){</span><span class="w">
    
    </span><span class="n">Set-VM</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-ProcessorCount</span><span class="w"> </span><span class="nv">$ProcessorCount</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-StaticMemory</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-MemoryStartupBytes</span><span class="w"> </span><span class="nv">$StaticMemory</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-AutomaticStartAction</span><span class="w"> </span><span class="nv">$StartAction</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-AutomaticStartDelay</span><span class="w"> </span><span class="nv">$AutoStartDelay</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-AutomaticStopAction</span><span class="w"> </span><span class="nv">$StopAction</span><span class="w">


</span><span class="p">}</span><span class="w">
</span><span class="c"># If Dynamic Memory</span><span class="w">
</span><span class="kr">Else</span><span class="p">{</span><span class="w">
    </span><span class="n">Set-VM</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-ProcessorCount</span><span class="w"> </span><span class="nv">$ProcessorCount</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-DynamicMemory</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-MemoryMinimumBytes</span><span class="w"> </span><span class="nv">$MinMemory</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-MemoryStartupBytes</span><span class="w"> </span><span class="nv">$StartupMemory</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-MemoryMaximumBytes</span><span class="w"> </span><span class="nv">$MaxMemory</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-AutomaticStartAction</span><span class="w"> </span><span class="nv">$StartAction</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-AutomaticStartDelay</span><span class="w"> </span><span class="nv">$AutoStartDelay</span><span class="w"> </span><span class="se">`
</span><span class="w">           </span><span class="nt">-AutomaticStopAction</span><span class="w"> </span><span class="nv">$StopAction</span><span class="w">

</span><span class="p">}</span><span class="w">

</span><span class="c">## Set the primary network adapters</span><span class="w">
</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-VM</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-VMNetworkAdapter</span><span class="w">
</span><span class="nx">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$VlanId</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapterVLAN</span><span class="w"> </span><span class="nt">-Access</span><span class="w"> </span><span class="nt">-VlanId</span><span class="w"> </span><span class="nv">$VlanId</span><span class="p">}</span><span class="w">
</span><span class="kr">else</span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapterVLAN</span><span class="w"> </span><span class="nt">-untagged</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$VMQ</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-VmqWeight</span><span class="w"> </span><span class="nx">100</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-VmqWeight</span><span class="w"> </span><span class="nx">0</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$IPSecOffload</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IPsecOffloadMaximumSecurityAssociation</span><span class="w"> </span><span class="nx">512</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IPsecOffloadMaximumSecurityAssociation</span><span class="w"> </span><span class="nx">0</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$SRIOV</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IovQueuePairsRequested</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-IovInterruptModeration</span><span class="w"> </span><span class="nx">Default</span><span class="w"> </span><span class="nt">-IovWeight</span><span class="w"> </span><span class="nx">100</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IovWeight</span><span class="w"> </span><span class="nx">0</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$MacSpoofing</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-MacAddressSpoofing</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-MacAddressSpoofing</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$DHCPGuard</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-DHCPGuard</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-DHCPGuard</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$RouterGuard</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-RouterGuard</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-RouterGuard</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">

</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NicTeaming</span><span class="p">){</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-AllowTeaming</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$PrimaryNetAdapter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-AllowTeaming</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">



</span><span class="c">## VHD(X) OS disk copy</span><span class="w">
</span><span class="nv">$OsDiskInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Item</span><span class="w"> </span><span class="nv">$SysVHDPath</span><span class="w">
</span><span class="n">Copy-Item</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$SysVHDPath</span><span class="w"> </span><span class="nt">-Destination</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$VHDPath</span><span class="p">)</span><span class="w">
</span><span class="n">Rename-Item</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$VHDPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$OsDiskInfo</span><span class="o">.</span><span class="nf">Name</span><span class="p">)</span><span class="w"> </span><span class="nt">-NewName</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$OsDiskName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$OsDiskInfo</span><span class="o">.</span><span class="nf">Extension</span><span class="p">)</span><span class="w">

</span><span class="c"># Attach the VHD(x) to the VM</span><span class="w">
</span><span class="n">Add-VMHardDiskDrive</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$VHDPath</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$OsDiskName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$OsDiskInfo</span><span class="o">.</span><span class="nf">Extension</span><span class="p">)</span><span class="w">

</span><span class="nv">$OsVirtualDrive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-VMHardDiskDrive</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="nt">-ControllerNumber</span><span class="w"> </span><span class="nx">0</span><span class="w">
     
</span><span class="c"># Change the boot order to the VHDX first</span><span class="w">
</span><span class="n">Set-VMFirmware</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="nt">-FirstBootDevice</span><span class="w"> </span><span class="nv">$OsVirtualDrive</span><span class="w">

</span><span class="c"># For additional each Disk in the collection</span><span class="w">
</span><span class="kr">Foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$Disk</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$ExtraDrive</span><span class="p">){</span><span class="w">
    </span><span class="c"># if it is dynamic</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Type</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"Dynamic"</span><span class="p">){</span><span class="w">
        </span><span class="n">New-VHD</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".vhdx"</span><span class="p">)</span><span class="w"> </span><span class="se">`</span><span class="w">
                </span><span class="nt">-SizeBytes</span><span class="w"> </span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Size</span><span class="w"> </span><span class="se">`</span><span class="w">
                </span><span class="nt">-Dynamic</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="c"># if it is fixed</span><span class="w">
    </span><span class="kr">Elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Type</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"Fixed"</span><span class="p">){</span><span class="w">
        </span><span class="n">New-VHD</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".vhdx"</span><span class="p">)</span><span class="w"> </span><span class="se">`</span><span class="w">
                </span><span class="nt">-SizeBytes</span><span class="w"> </span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Size</span><span class="w"> </span><span class="se">`</span><span class="w">
                </span><span class="nt">-Fixed</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="c"># Attach the VHD(x) to the Vm</span><span class="w">
    </span><span class="n">Add-VMHardDiskDrive</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="se">`
</span><span class="w">                        </span><span class="nt">-Path</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Path</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"\"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">$Disk</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".vhdx"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="c"># foreach additional network adapters</span><span class="w">
</span><span class="kr">Foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$NICs</span><span class="p">){</span><span class="w">
    </span><span class="c"># add the NIC</span><span class="w">
    </span><span class="n">Add-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-VMName</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="nt">-SwitchName</span><span class="w"> </span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">VMSwitch</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Network Adapter </span><span class="nv">$i</span><span class="s2">"</span><span class="w">
    
    </span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-VM</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"Network Adapter </span><span class="nv">$i</span><span class="s2">"</span><span class="w"> 
    </span><span class="c"># Configure the NIC regarding the option</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">VLAN</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapterVLAN</span><span class="w"> </span><span class="nt">-Access</span><span class="w"> </span><span class="nt">-VlanId</span><span class="w"> </span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">VLAN</span><span class="p">}</span><span class="w">
    </span><span class="kr">else</span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapterVLAN</span><span class="w"> </span><span class="nt">-untagged</span><span class="p">}</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">VMQ</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-VmqWeight</span><span class="w"> </span><span class="nx">100</span><span class="p">}</span><span class="w">
    </span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-VmqWeight</span><span class="w"> </span><span class="nx">0</span><span class="p">}</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">IPSecOffload</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IPsecOffloadMaximumSecurityAssociation</span><span class="w"> </span><span class="nx">512</span><span class="p">}</span><span class="w">
    </span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IPsecOffloadMaximumSecurityAssociation</span><span class="w"> </span><span class="nx">0</span><span class="p">}</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">SRIOV</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IovQueuePairsRequested</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-IovInterruptModeration</span><span class="w"> </span><span class="nx">Default</span><span class="w"> </span><span class="nt">-IovWeight</span><span class="w"> </span><span class="nx">100</span><span class="p">}</span><span class="w">
    </span><span class="kr">Else</span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-IovWeight</span><span class="w"> </span><span class="nx">0</span><span class="p">}</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">MacSpoofing</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-MacAddressSpoofing</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
    </span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-MacAddressSpoofing</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">DHCPGuard</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-DHCPGuard</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
    </span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-DHCPGuard</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">RouterGuard</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-RouterGuard</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
    </span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-RouterGuard</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">

    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$NetAdapter</span><span class="o">.</span><span class="nf">NicTeaming</span><span class="p">){</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-AllowTeaming</span><span class="w"> </span><span class="nx">on</span><span class="p">}</span><span class="w">
    </span><span class="kr">Else</span><span class="w"> </span><span class="p">{</span><span class="nv">$ExtraNic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Set-VMNetworkAdapter</span><span class="w"> </span><span class="nt">-AllowTeaming</span><span class="w"> </span><span class="nx">off</span><span class="p">}</span><span class="w">

    </span><span class="nv">$i</span><span class="o">++</span><span class="w">

    
</span><span class="p">}</span><span class="w">
</span><span class="c">#Remove # If cluster</span><span class="w">
</span><span class="c">#Add-ClusterVirtualMachineRole -VirtualMachine $VMName</span><span class="w">
</span><span class="n">Set-VMProcessor</span><span class="w"> </span><span class="nv">$VMName</span><span class="w"> </span><span class="nt">-CompatibilityForMigrationEnabled</span><span class="w"> </span><span class="bp">$true</span><span class="w">
</span><span class="n">Set-VMProcessor</span><span class="w"> </span><span class="nv">$vmname</span><span class="w"> </span><span class="nt">-MaximumCountPerNumaNode</span><span class="w"> </span><span class="nx">28</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></pre></table></code></div></div><p>Remember to adjust the script’s paths and filenames according to your environment’s setup, such as:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$SysVHDPath = "C:\Path\To\Your\Template\vTemplateServer2022.vhdx"
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$VMPath         = "C:\Path\To\Your\Virtual Machines"
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$VHDPath     = "C:\Path\To\Your\Virtual Hard Disks"
</pre></table></code></div></div><p>Be sure to also watch the <a href="https://mylemans.online/posts/Server2022-HyperV-EnableDeduplication/">‘Enable Deduplication’</a> video, which complements this guide. Deduplication is a powerful tool that can significantly reduce the disk space used by our templates. This is especially beneficial in environments where storage costs are a concern or where storage capacity is limited.</p><p>Together, these resources will equip you with the knowledge and skills to effectively manage and scale your virtualized environment, making your IT infrastructure more robust, flexible, and cost-effective.</p><p>Happy Virtualizing!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/windows/">Windows</a>, <a href="/categories/server/">Server</a>, <a href="/categories/2022/">2022</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/server/" class="post-tag no-text-decoration" >server</a> <a href="/tags/2022/" class="post-tag no-text-decoration" >2022</a> <a href="/tags/hyper-v/" class="post-tag no-text-decoration" >hyper-v</a> <a href="/tags/virtualisation/" class="post-tag no-text-decoration" >virtualisation</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Server%202022%20-%20Hyper-V%20-%20Virtual%20Machine%20Templates%20-%20Mylemans%20Online&url=https%3A%2F%2Fmarcmylemans.github.io%2Fposts%2FServer2022-Hyper-V-VirtualMachineTemplates%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Server%202022%20-%20Hyper-V%20-%20Virtual%20Machine%20Templates%20-%20Mylemans%20Online&u=https%3A%2F%2Fmarcmylemans.github.io%2Fposts%2FServer2022-Hyper-V-VirtualMachineTemplates%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmarcmylemans.github.io%2Fposts%2FServer2022-Hyper-V-VirtualMachineTemplates%2F&text=Server%202022%20-%20Hyper-V%20-%20Virtual%20Machine%20Templates%20-%20Mylemans%20Online" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmarcmylemans.github.io%2Fposts%2FServer2022-Hyper-V-VirtualMachineTemplates%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/AADConnectMigration/">AAD Connect / Cloud Sync with Existing Cloud Users</a><li class="text-truncate lh-lg"> <a href="/posts/Remote_Desktop_OneDrive_Single_Sign_On/">Remote Desktop - OneDrive Single Sign On</a><li class="text-truncate lh-lg"> <a href="/posts/Windows11HybridADJoin/">Windows 11 - Active Directory - Hybrid Join - Azure AD</a><li class="text-truncate lh-lg"> <a href="/posts/IntuneAppsAndPolicy/">Intune - Applications and Policies</a><li class="text-truncate lh-lg"> <a href="/posts/RemoteDesktopPart2/">Server 2022 - Remote Desktop Services - Part 2</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/server/">server</a> <a class="post-tag btn btn-outline-primary" href="/tags/2022/">2022</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/rdp/">rdp</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/11/">11</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpo/">gpo</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/intune/">intune</a> <a class="post-tag btn btn-outline-primary" href="/tags/mdt/">mdt</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/Server2022-Installing-Hyper-V-Role/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1671264000" data-df="ll" > Dec 17, 2022 </time><h4 class="pt-0 my-2">Server 2022 - Installing Hyper-V Role</h4><div class="text-muted"><p> Hello and welcome to a key tutorial in our Windows Server 2022 series! Today, we’re diving into the installation of the Hyper-V Role on Server 2022 – a crucial step for anyone looking to le...</p></div></div></a></article><article class="col"> <a href="/posts/Server2022-HyperV-EnableDeduplication/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1671267600" data-df="ll" > Dec 17, 2022 </time><h4 class="pt-0 my-2">Server 2022 - Hyper-V - Enable Deduplication</h4><div class="text-muted"><p> Welcome to another insightful tutorial in our Windows Server 2022 series. In this session, we’re exploring a powerful feature - Deduplication in Server 2022. This functionality is essential...</p></div></div></a></article><article class="col"> <a href="/posts/Server2022-Hyper-V-InstallWindows11/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1671436800" data-df="ll" > Dec 19, 2022 </time><h4 class="pt-0 my-2">Server 2022 - Hyper-V - Install Windows 11</h4><div class="text-muted"><p> {% youtube “https://youtu.be/Vzks9iqvNos” %} Join us in this instructional video as we navigate through the process of installing Windows 11 within a Hyper-V environment on Windows Server 2022. Th...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/Server2022-HyperV-EnableDeduplication/" class="btn btn-outline-primary" aria-label="Older" ><p>Server 2022 - Hyper-V - Enable Deduplication</p></a> <a href="/posts/Server2022-Hyper-V-InstallWindows11/" class="btn btn-outline-primary" aria-label="Newer" ><p>Server 2022 - Hyper-V - Install Windows 11</p></a></nav><div id="disqus_thread"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://marcmylemans.github.io/posts/Server2022-Hyper-V-VirtualMachineTemplates/'; this.page.identifier = '/posts/Server2022-Hyper-V-VirtualMachineTemplates/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://blog-mylemans-online.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p> © <time>2024</time> <a href="https://github.com/marcmylemans">Marc Mylemans</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/server/">server</a> <a class="post-tag btn btn-outline-primary" href="/tags/2022/">2022</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/rdp/">rdp</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/11/">11</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpo/">gpo</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/intune/">intune</a> <a class="post-tag btn btn-outline-primary" href="/tags/mdt/">mdt</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.3/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WPGGY562HQ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WPGGY562HQ'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
